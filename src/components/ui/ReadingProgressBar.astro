---
interface Props {
  targetId?: string; // ID del container da monitorare
}

const { targetId = 'main-content' } = Astro.props;
---

<div id="reading-progress-container" class="progress-container" aria-hidden="true">
  <div id="reading-progress-bar" class="progress-bar" data-target={targetId}></div>
</div>

<style>
  .progress-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(0, 0, 51, 0.5);
    z-index: 9999;
    pointer-events: none;
  }

  .progress-bar {
    height: 100%;
    background: #dfd090; /* Oro */
    width: 0%;
    transition: width 0.1s ease-out;
    box-shadow: 0 0 10px rgba(223, 208, 144, 0.5);
  }
</style>

<script>
  function updateProgress() {
    const bar = document.getElementById('reading-progress-bar');
    if (!bar) return;

    const targetId = bar.getAttribute('data-target') || 'main-content';
    const content = document.getElementById(targetId);
    
    if (content) {
      const windowHeight = window.innerHeight;
      const contentTop = content.offsetTop;
      const contentHeight = content.offsetHeight;
      const scrollTop = window.scrollY;

      // Calcola quanto dell'elemento target Ã¨ stato letto
      const scrollDistance = scrollTop - contentTop;
      const progressHeight = contentHeight - windowHeight;
      
      let percentage = (scrollDistance / progressHeight) * 100;
      
      // Limita tra 0 e 100
      percentage = Math.max(0, Math.min(100, percentage));
      
      bar.style.width = `${percentage}%`;
    }
  }

  // Listener per scroll e View Transitions
  window.addEventListener('scroll', updateProgress);
  document.addEventListener('astro:after-swap', updateProgress);
</script>