---
import MainLayout from '@/components/layout/MainLayout.astro';
import PostScene from '@/components/blog/PostScene.astro';
import { getCollection } from 'astro:content';
import { render } from 'astro:content';
import { supportedLanguages, defaultLang, type LangCode } from '@/i18n/config';

// âœ… Genera / e /it, /es, ecc.
export async function getStaticPaths() {
  return supportedLanguages.map(lang => ({
    params: { lang: lang === defaultLang ? undefined : lang },
    props: { lang },
  }));
}

const { lang } = Astro.props as { lang: LangCode };

const pages = await getCollection('pages', ({ data }) => 
  data.lang === lang && data.translationId === 'home'
);

if (pages.length === 0) {
  return Astro.redirect(`/${lang}/404`);
}

const entry = pages[0];
const { Content } = await render(entry);
const { title, description } = entry.data;
---

<MainLayout lang={lang} title={title} description={description}>
  <PostScene title={title}>
    <Content />
  </PostScene>
</MainLayout>