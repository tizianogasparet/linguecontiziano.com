---
import { getCollection, render } from 'astro:content';
import MainLayout from '@/components/layout/MainLayout.astro';
import PostScene from '@/components/blog/PostScene.astro';
import { supportedLanguages, defaultLang, type LangCode } from '@/i18n/config';

export async function getStaticPaths() {
  return supportedLanguages.map((langCode) => {
    // en -> undefined (root), it -> 'it', es -> 'es'
    const langParam = langCode === defaultLang ? undefined : langCode;
    return {
      params: { lang: langParam },
      props: { lang: langCode },
    };
  });
}

const { lang } = Astro.props as { lang: LangCode };

// Recupero il contenuto della home per la lingua specifica
const allPages = await getCollection('pages');
const homeContent = allPages.find(
  (p) => p.data.translationId === 'home' && p.data.lang === lang
);

if (!homeContent) {
  return Astro.redirect('/404');
}

const { Content } = await render(homeContent);
---

<MainLayout 
  lang={lang} 
  title={homeContent.data.title} 
  description={homeContent.data.description}
>
  <PostScene title={homeContent.data.title}>
    <Content />
  </PostScene>
</MainLayout>