---
import MainLayout from '@/components/layout/MainLayout.astro';
import { getCollection, render } from 'astro:content';
import { routes } from '@/i18n/routes';
import type { LangCode } from '@/i18n/config';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');

  return blogEntries.map(entry => {
    const [lang, ...slugParts] = entry.id.split('/') as [LangCode, ...string[]];
    const post_slug = slugParts.join('/').replace(/\.md$/, '');
    
    // Ora lang è tipizzato come LangCode, quindi l'accesso a routes[lang] è sicuro
    const categorySlug = routes[lang][entry.data.category];

    return {
      params: { 
        lang, 
        category: categorySlug, 
        post_slug 
      },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<MainLayout 
  title={entry.data.title} 
  description={entry.data.description} 
  lang={entry.data.lang}
>
  <article class="prose-monolith">
    <header>
      <time datetime={entry.data.pubDate.toISOString()}>
        {entry.data.pubDate.toLocaleDateString(entry.data.lang)}
      </time>
      <h1>{entry.data.title}</h1>
    </header>
    <Content />
  </article>
</MainLayout>